{{>layouts/header}}

<h1>Stream Viewer</h1>
<img id="stream" src="http://175.123.202.85:20800/stream.mjpg" alt="Stream not available">

<h1>UDP Streaming</h1>
<div>
    <button onclick="fetchSensorData()">Get Sensor Data</button>
    <div id="sensorData"></div>
    <button onclick="fetchRotaterData()">Get Rotater Data</button>
    <div id="rotaterData"></div>
    <button onclick="fetchSprinklerData()">Get Sprinkler Data</button>
    <div id="sprinklerData"></div>
    <button onclick="fetchLedData()">Get LED Data</button>
    <div id="ledData"></div>
    <button id="fetchUdpDataButton">Capture Screenshot</button>
    <div id="udpDataContainer" style="display: none;">
        <h3>Captured Screenshot</h3>
        <img id="udpScreenshot" alt="Screenshot not available">
    </div>
</div>

<script>
    function fetchSensorData() {
        const url = '/api/udp/custom';// 서버의 엔드포인트 URL
        const requestData = { type: 'sensor' };// 요청에 포함될 JSON 데이터
        fetchAndDisplayData(url, 'sensorData', 'Sensor', requestData);// 데이터를 가져오고 표시하는 함수 호출
    }

    function fetchRotaterData() {
        const url = '/api/udp/custom';// 서버의 엔드포인트 URL
        const requestData = { type: 'rotater' };// 요청에 포함될 JSON 데이터
        fetchAndDisplayData(url, 'rotaterData', 'Rotater', requestData);// 데이터를 가져오고 표시하는 함수 호출
    }

    function fetchSprinklerData() {
        const url = '/api/udp/custom';// 서버의 엔드포인트 URL
        const requestData = { type: 'sprinkler' };// 요청에 포함될 JSON 데이터
        fetchAndDisplayData(url, 'sprinklerData', 'Sprinkler', requestData);// 데이터를 가져오고 표시하는 함수 호출
    }

    function fetchLedData() {
        const url = '/api/udp/custom';// 서버의 엔드포인트 URL
        const requestData = { type: 'led' };// 요청에 포함될 JSON 데이터
        fetchAndDisplayData(url, 'ledData', 'LED', requestData);// 데이터를 가져오고 표시하는 함수 호출
    }

    function fetchAndDisplayData(url, containerId, dataTypeName, requestData) {
        fetch(url, {
            method: 'POST', // HTTP 요청 메서드를 POST로 설정
            headers: {
                'Content-Type': 'application/json' // 요청 헤더에 Content-Type을 JSON으로 설정
            },
            body: JSON.stringify(requestData) // 요청 본문을 JSON 문자열로 변환하여 설정
        })
        .then(response => response.json()) // 서버 응답을 JSON 형식으로 파싱
        .then(data => {
            const container = document.getElementById(containerId); // 데이터를 표시할 HTML 요소 선택
            container.textContent = JSON.stringify(data); // 요소의 텍스트 콘텐츠를 JSON 데이터로 설정

            const dataTypeInfo = document.createElement('p'); // 새로운 <p> 요소 생성
            dataTypeInfo.textContent = `${dataTypeName} Data`; // <p> 요소의 텍스트 콘텐츠를 데이터 유형으로 설정
            container.prepend(dataTypeInfo); // <p> 요소를 컨테이너의 첫 번째 자식으로 추가
        })
        .catch(error => console.error(`Error fetching ${containerId} data:`, error)); // 에러 발생 시 콘솔에 에러 메시지 출력
    }

    // 스크린샷
    const fetchUdpDataButton = document.getElementById('fetchUdpDataButton');
    const udpDataContainer = document.getElementById('udpDataContainer');
    const udpScreenshotElement = document.getElementById('udpScreenshot');

    fetchUdpDataButton.onclick = function() {
        fetch('/api/udp/screenshot')
            .then(response => response.json())
            .then(data => {
                if (data.screenshot) {
                    udpScreenshotElement.src = 'data:image/jpeg;base64,' + data.screenshot;
                    udpDataContainer.style.display = 'block';
                } else {
                    console.error('Error fetching screenshot:', data.error);
                }
            })
            .catch(error => console.error('Error fetching screenshot:', error));
    };
</script>

{{>layouts/footer}}